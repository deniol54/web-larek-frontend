# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/types/ — папка с типами

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

В качестве архитектуры для проекта за основу взят паттерн MVC.
Реализована единая модель данных приложения в файле src/components/model/ShopState.ts, содержащая всю логику работы с данными и возможные действия над ними. Все изменения данных происходят через методы модели, а она в свою очередь уведомляет об изменениях через метод настроек onChange(changes: AppStateChanges). Подключение модели к системе событий производится через обертку src/components/model/AppStateEmitter.ts.

Экземпляр модели передается в контроллеры, которые по факту являются обработчиками пользовательских действий и обновляют состояние модели через ее методы.

При обработке событий возникающих в AppStateEmitter производится обновление данных в отображениях. 

### Данные (Модели)

1. Класс Product
Сожержит в себе описание товаров, находящтхся на странице магазина.

Поля:
- productId - ID товара на сервере, 
- productType - категория товара,
- productTitle - название товара,
- productImage - ссылка на картинку товара,
- productPrice - цена товара,
- productDescription - описание товара

2. Класс UserData
Содержит в себе информацию пользователя необходимую для осуществления заказа.

Поля:
- email - электронная почта,
- phoneNumber - номер телефона,
- address - адрес,
- payType - тип оплаты

3. Класс ProductBasket
Содержит себе информацию о корзине с покупками.

Поля:
- products - товары, находящиеся в корзине,
- basketPrice - общая стоимость товаров в корзине,
- basketCount - количество товаров в корзине

4. Класс Catalog
Класс для описания каталога товаров на странице.

Поля:
- products - список товаров

5. Класс IShopAPI 
Класс для взаимодействия с API сервера

Методы:
- getProducts - получить все товары с сервера,
- getCertainProduct - получить описание товара по его ID,
- orderProducts - сделать заказ

6. Класс Order
Класс описывающий заказ, содержит данные пользователя и список заказываемых продуктов.

Поля:
- Все поля реализованные в классе UserData,
- products - список товаров в заказе


7. Класс OrderResult
Класс для описания результата заказа. Содержит уникальный идентификатор заказа и сумму закза.

Поля:
- id - идентификотор заказа,
- total - сумма заказа

8. Класс ShopState
Класс, описывающий состояние магазина. 

Поля:
- catalog - католог товаров на странице,
- basket - корзина,
- userData - данные пользователя для заказа,
- basketTotal - колчество товаров в корзине,
- order - данные о заказе для отправки на сервер,
- openedModal - информация об открытых модальных окнах на странице,
- isOrderReady - готовность заказа,
- modalMessage - сообщение об ошибке,
- isError - есть ли ошибка при валидации формы

Методы:
- loadProducts - загрузка товаров с сервера,
- orderProducts- заказ товаров,
- selectProduct - выбрать товар,
- removeProduct - удалить товар из корзины,
- fillUserData - заполнение данных пользователя для заказа,
- isValidContacts - проверка валидноти заполненных данных,
- openModal - открыть модальное окно,
- setMessage - вывести сообщение об ошибке


### Отображение

Отображения в проекте разделены на три типа:

- common — общие компоненты, не зависящие от доменной области проекта
- partial — частичные компоненты, реализующие доменную область проекта
- screen — верхнеуровневые компоненты, которые являются экранами приложения

Создание компонентов для отображение происходит через класс IView, который является дженериком и принимает в себя два типа: тип данных(значения для вывода) и тип настроек(селекторы для вставки данных).

Поля:
- element - корневой HTML элемент

Методы:
- copy - копирующий конструктор,
- render - метод рендера

Классы *Data отвечают за наполнение контейнера данными, а классы *Settings отвечают за настройку контейнера.

#### Раздел common

1. Класс ButtonData
Содержит данные для кнопки

Поля:
- label - название кнопки

2. Класс HeaderData
Содержит данные для шапки

Поля:
- title - заголовок шапки,
- description - описание,
- action - действие, например нажатие на кнопку

3. Класс HeaderSettings
Содержит настройки для шапки

Поля:
- title - селектор для шапки,
- description - селектор для описания,
- action - селектор для действия

4. Класс ItemData
Класс для описания элемента списка

Поля:
- id - идентификатор элемента в списке

5. Класс ListData
Класс, содержащий данные списка, является дженериком

Поля: 
- items - элементы списка

6. Класс ListSettings
Класс для описания настроек списка

Поля: 
- item - тип для отображения элемента списка,
- activeItemClass - селектор для активного элемента списка,
- itemClass - селектор для элемента списка

7. Класс ModalData
Класс для описания содержимого модального окна

Поля:
- header - шапка окна,
- content - содержимое окна,
- message - сообщение при обибке валидации,
- isActive - индикатор, показывающий открыто ли окно,
- isError - индикатор, показывающий есть ли ошибки в валиации данных в окне

8. Класс ModalSettings
Класс для описания настроек модального окна

Поля:
close - селектор для зактытого модального окна,
header - селектор для шапки окна,
content - селектор для содержимого,
footer - селектор для подвала окна,
message - селектор для вывода сообщения об ошибке,
headerView - отображение шапки,
contentView - отображение содержимого,
actions - элементы окна, меняющиеся при определенных действиях,
activeClass - селектор для открытого модального окна,
messageErrorClass - селектор для сообщения об ошибке валидации

Методы:
onOpen - дейсткие при открытии окна,
onClose - действие при закрытии окна

#### Раздел partial

1. Класс CardData
Класс для описания содержимого карточки товара

Поля:
- id - идентификатор товара,
- image - изображение товара,
- title - название товара,
- category - категория товара,
- price - цена товара

2. Класс CardDataModal
Класс для описания содержимого карточки товара в модальном окне

Поля:
- text - описание товара,
- также все поля класса CardData

3. Класс CardDataBasket
Класс для описания содержимого товара в корзине

Поля:
- id- идентификатор товара,
- title - название товара,
- price - цена товара

4. Класс CardSettings
Класс для настройки содержимого карточки товара

Поля:
image - селектор для изображения товара,
title- селектор для названия тоара,
category - селектор для категории товара,
price - селектор для цены товара,
text - селектор для описания товара,
isModal - индикатор, показывающий отображается ли карточка в модальном окне,
isBasket - индикатор, показывающий отображается ли карточка в корзине

5. Класс ContactsData
Класс, содержащий контактные данные пользавателя

Поля: 
- phoneNumber - номер телефона,
- email - электоронная почта

6. Класс ContactsSettings
Класс для настройки отображения контактных данных пользователя

Поля: 
- phoneNumber - селектор для номера телефона,
- email - селектор для электоронной почты

7. Класс OrderData
Класс для отображения данных для заказа

Поля:
- payType - тип оплаты заказа,
- address - адрес

8. Класс Order Settings
Класс для настройки отображения данных для заказа

Поля:
- payType - селектор для типа оплаты заказа,
- address - селектор для адрес

9. Класс PageData
Класс для данных необходимых для отборражния на странице

Поля:
- counter - счетчик товаров в корзине,
- isLocked - индикатор доступности основной страницы(блокировка прокрутки при открытых модальных окнах)

10. Класс PageSettings
Класс для настройки отображения страницы

Поля:
- wrapper - селектор родительского элемента страницы для блокировки
- counter - селектор для установки счетчика тоаров корзины,
- basket - селектор для корзины,
- lockedClass - селектор закрывающий доступ к странице

#### Раздел screen

1. Класс BasketData
Класс для отображения данных корзины

Поля:
- products - товары в корзине,
- isActive - индикатор, показывающий активна ли корзина,
- header - шапка корзины,
- total - общая стоимость товаров в корзине

2. Класс BasketSettings
Класс для настройки отображения корзины

Поля:
- productList - селектор для списка товаров в корзине,
- total - селектор для отображения суммы корзины

Методы:
- onRemove - изменение отображения при удалениии товара из корзины, 
- onClose - изменение отображения закрытиии корзины,
- onNext - изменение отображения при начале оформления заказа

3. Класс MainData
Класс для отображения страницы

Поля:
- counter - счетчик товаров корзины, 
- items - катрочки товаров

4. Класс MainSettings
Класс для настройки отображения страницы

Методы:
- onOpenBasket - изменение отображения при открытии корзины,
- onOpenProduct - изменение отображения при открытии катрочки товара

5. Класс ModalScreenSettings
Класс для настройки отображения модального окна

Методы:
- onClose - изменение отображения при закрытии окна,
- onNext - изменение отображения при перезоде к следующему окну

6. Класс OrederFormData
Класс для отображения формы ввода данных пользователя для заказа

Поля:
- contacts - данные для заказа,
- header - данные шапки формы,
- isDisabled - индикатор открытого окна,
- message - сообщения об ошибке,
- total - суммы товаров в корзине,
- isError - индикатор ошибки валидации

7. Класс OrderFormSetting
Класс для настройки отображения формы ввода данных пользователя для заказа

Методы:
- onChange - изменение отображения при изменении пользовательских данных,
- onClose - изменение отображения при закрытии формы ввода,
- onNext - изменение отображения при переходе к следующему окну,
- onBack - изменение отображения при переходе к предыдущему окну

8. Класс SuccessData
Класс для отображения окна успешного оформления заказа

Поля:
- content - содержимое окна,
- total - сумма заказа,
- isActive - индикатор открытого окна

9. Класс SuccessSettings
Класс для настройки отображения окна успешного оформления заказа

Методы:
- изменение отображения при закрытии окна


### Контроллеры

Контроллеры являются обработчиками пользовательских действий и обновляют состояние модели через ее методы. Пользовательские действия, меняющие состояние приложения описаны в файле ShopState.ts
Список действий следующий:
- openModal - открытие модальных окон,
- setModalMessage - ошибка в валидации вводимых пользователем данных,
- selectProduct - выбор продукта и добавление его в корзну,
- orderData - заполнение данных для заказа,
- openBasket - действия с корзиной,
- order - совершение заказа